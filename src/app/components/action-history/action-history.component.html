 <div class="custom-container">
  <div class="card history-card p-4">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Historique des actions</h2>
      <div class="flex items-center gap-2">
       <input #filter pInputText type="text" placeholder="Filtrer par utilisateur..." 
               (input)="historyTable.filterGlobal($event.target.value, 'contains')" />
      </div>
    </div>

    <ng-container *ngIf="history$ | async as history">
      <p-table 
        #historyTable
        [value]="history"
        rowGroupMode="subheader"
        groupRowsBy="username"
        [scrollable]="true"
        scrollHeight="400px"
        sortField="username"
        sortMode="single"
        [tableStyle]="{ 'min-width': '800px' }"
      >
        <!-- Header avec filtres intégrés -->
        <ng-template #header>
          <tr>
            <th>
              Action
            </th>
            <th>
              Date
  
    <input type="date" 
           class="column-filter pl-8" 
           (change)="historyTable.filter($event.target.value, 'timestamp', 'equals')" />
   

            </th>
          </tr>
        </ng-template>

        <!-- Group Header -->
        <ng-template #groupheader let-historyItem>
          <tr pRowGroupHeader class="bg-green-100 font-bold">
            <td colspan="2">
              {{ historyItem.username }} 
              (Total actions: {{ calculateActionTotal(historyItem.username, history) }})
            </td>
          </tr>
        </ng-template>

        <!-- Body -->
        <ng-template #body let-historyItem>
          <tr>
            <td>{{ historyItem.action }}</td>
            <td>{{ historyItem.timestamp | date:'short' }}</td>
          </tr>
        </ng-template>

        <!-- Empty Message -->
        <ng-template #emptymessage>
          <tr>
            <td colspan="2">Aucun historique trouvé.</td>
          </tr>
        </ng-template>

      </p-table>
    </ng-container>
  </div>
</div>
