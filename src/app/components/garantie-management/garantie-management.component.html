<div class="garantie-container">
  <h2>Gestion des Garanties et Clausiers</h2>

  <!-- Slider de navigation -->
  <div class="slider-nav">
    <button 
      [class.active]="activeTab === 'garanties'" 
      (click)="activeTab = 'garanties'">
      Garanties
    </button>
    <button 
      [class.active]="activeTab === 'clausiers'" 
      (click)="activeTab = 'clausiers'">
      Clausiers
    </button>
  </div>

  <!-- Section Garanties -->
  <div *ngIf="activeTab === 'garanties'" class="tab-content">
    <!-- Ajout d'une nouvelle garantie -->
    <div class="add-garantie">
      <input 
        type="text" 
        placeholder="Nouvelle garantie..." 
        [(ngModel)]="newGarantieLibelle" />
      <button (click)="addGarantie()" title="Ajouter">
        <i class="pi pi-plus"></i> Ajouter
      </button>
    </div>

    <!-- Message si aucune garantie -->
    <div *ngIf="garanties.length === 0" class="empty">
      Aucune garantie disponible.
    </div>

    <!-- Liste des garanties -->
    <div *ngIf="garanties.length > 0" class="garantie-list">
      <div *ngFor="let g of garanties" class="garantie-card" (click)="openBrancheDialog(g.id)">
        <div class="garantie-item">
          <span>{{ g.libelle || 'Nom non défini' }}</span>
          <i 
            class="pi pi-trash delete-icon"
            title="Supprimer"
            (click)="confirmDelete(g.id, g.libelle); $event.stopPropagation()">
          </i>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Clausiers -->
  <div *ngIf="activeTab === 'clausiers'" class="tab-content">
    <!-- Upload de PDF avec nom -->
    <div class="add-garantie">
      <input 
        type="text" 
        placeholder="Nom du clausier..." 
        [(ngModel)]="newClausierLibelle" />
      <input 
        type="file" 
        #fileInput
        (change)="onFileSelected($event)"
        accept=".pdf"
        style="display: none" />
      <button 
        class="add-file-btn"
        (click)="fileInput.click()">
        <i class="pi pi-upload"></i> Choisir PDF
      </button>
    </div>

    <!-- Message si aucun clausier -->
    <div *ngIf="clausiers.length === 0" class="empty">
      Aucun clausier disponible.
    </div>

    <!-- Liste des clausiers -->
    <div *ngIf="clausiers.length > 0" class="clausier-grid">
      <div *ngFor="let clausier of clausiers" class="clausier-card">
        <div class="clausier-header">
          <h4>{{ clausier.nom || 'Sans nom' }}</h4>
          <i 
            class="pi pi-trash delete-icon"
            title="Supprimer le clausier"
            (click)="confirmDeleteClausier(clausier.id, clausier.nom)">
          </i>
        </div>
        
        <!-- Affichage du fichier PDF -->
        <div class="files-section">
          <h5>Fichier PDF :</h5>
          <div *ngIf="clausier.file; else noFile" class="file-item">
            <i class="pi pi-file-pdf"></i>
            <span class="file-name">  {{ clausier.nom }}</span>
            <div class="file-actions">
              <i class="pi pi-download" title="Télécharger" (click)="downloadPdf(clausier)"></i>
            </div>
          </div>
          <ng-template #noFile>
            <div class="no-files">Aucun fichier PDF</div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>

<!-- Popup de sélection de branche (pour garanties) -->
<div *ngIf="displayBrancheDialog" class="popup-overlay">
  <div class="p-dialog popup-content">
    <h3>Sélectionner la branche</h3>

    <div class="field">
      <label for="branche-select">Branche</label>
      <select id="branche-select" [(ngModel)]="selectedBranche">
        <option *ngFor="let b of Branche" [value]="b.value">{{ b.label }}</option>
      </select>
    </div>

    <div class="popup-actions">
      <button (click)="onBrancheSelected()">Valider</button>
      <button (click)="displayBrancheDialog = false">Annuler</button>
    </div>
  </div>
</div>