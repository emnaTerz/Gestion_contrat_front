
<div *ngIf="showTopbar" class="topbar">
  <button *ngIf="isAdmin" 
          pButton icon="pi pi-chart-bar" 
          class="p-button-text"
          (click)="navigateToDashboard()" 
          title="Dashboard">
  </button>

  <button *ngIf="isAdmin" 
          pButton icon="pi pi-history" 
          class="p-button-text"
          (click)="navigateToHistory()" 
          title="Historique">
  </button>

  <!-- Nouveau bouton Users -->
  <button *ngIf="isAdmin" 
          pButton icon="pi pi-users" 
          class="p-button-text"
          (click)="navigateToUsers()" 
          title="Utilisateurs">
  </button>

  <button *ngIf="isAdmin" 
          pButton icon="pi pi-dollar" 
          class="p-button-text"
          (click)="openDialog()" 
          title="tarif">
  </button>
<!-- Nouveau bouton Ajouter / Modifier Contrat -->
<button *ngIf="isAdmin"
        pButton
        icon="pi pi-pencil"
        class="p-button-text"
        (click)="openBranchDialogForAdmin()"
        title="Créer Contrat">
</button>


  <!-- Nouveau bouton Garanties -->
  <button *ngIf="isAdmin" 
          pButton icon="pi pi-shield" 
          class="p-button-text"
          (click)="navigateToGaranties()" 
          title="Gestion des Garanties">
  </button>
  
  <!-- Nouveau bouton Contrats -->
  <button *ngIf="isAdmin" 
          pButton icon="pi pi-file" 
          class="p-button-text"
          (click)="navigateToContrats()" 
          title="Liste des Contrats">
  </button>

  <button pButton icon="pi pi-sign-out" 
          class="p-button-text p-button-danger"
          (click)="logout()" 
          title="Logout">
  </button>
</div>

<!-- Dialog déplacé EN DEHORS de la topbar -->
<p-dialog 
  header="Gestion des Tarifs" 
  [(visible)]="displayDialog" 
  [modal]="true" 
  [style]="{width: '500px'}">

  <div class="field">
    <label for="branche">Choisir Branche :</label>
    <select 
      id="branche"
      name="branche"
      [(ngModel)]="selectedBranche" 
      (change)="onBrancheChange()" 
      autocomplete="off">
      <option *ngFor="let b of branches" [value]="b">{{ b }}</option>
    </select>
  </div>

  <div *ngIf="tarif">
    <div class="field">
      <label for="fq">FQ :</label>
      <input 
        id="fq"
        name="fq"
        type="number" 
        [(ngModel)]="tarif.fq" 
        autocomplete="off" />
    </div>

    <div class="field">
      <label for="fefg">FE/FG :</label>
      <input 
        id="fefg"
        name="fefg"
        type="number" 
        [(ngModel)]="tarif.feFg" 
        autocomplete="off" />
    </div>

    <div class="field">
      <label for="prixAdhesion">Prix Adhésion :</label>
      <input 
        id="prixAdhesion"
        name="prixAdhesion"
        type="number" 
        [(ngModel)]="tarif.prixAdhesion" 
        autocomplete="off" />
    </div>

    <div class="field">
      <label for="taux">Taux :</label>
      <input 
        id="taux"
        name="taux"
        type="number" 
        [(ngModel)]="tarif.taux" 
        autocomplete="off" />
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button 
      pButton 
      label="Annuler" 
      icon="pi pi-times" 
      class="p-button-text" 
      (click)="displayDialog=false">
    </button>

    <button 
      pButton 
      label="Enregistrer" 
      icon="pi pi-check" 
      [disabled]="!tarif" 
      (click)="save()">
    </button>
  </ng-template>
</p-dialog>

<p-dialog header="Choisir la branche" [(visible)]="displayBranchDialog"
          [modal]="true" [closable]="true" [style]="{width: '400px'}">
  <div class="field">
    <label for="branche">Sélectionnez la branche :</label>
    <select [(ngModel)]="selectedBranch" name="selectedBranch">
      <option *ngFor="let b of branchOptionsForDialog" [value]="b.value">
        {{ b.label }}
      </option>
    </select>
  </div>

  <div class="flex justify-end mt-3">
    <button pButton type="button" label="Annuler" class="p-button-text" (click)="displayBranchDialog=false"></button>
    <button pButton type="button" label="Valider" class="p-button-success ml-2"
            [disabled]="!selectedBranch" (click)="goToSelectedBranch()"></button>
  </div>
</p-dialog>
<!-- Modale pour choisir le code produit (branche Q) -->
<p-dialog header="Choisir le code produit" [(visible)]="displayProductCodeDialog"
          [modal]="true" [closable]="true" [style]="{width: '400px'}">
  <div class="field">
    <label for="productCode">Sélectionnez le code produit :</label>
    <select [(ngModel)]="selectedProductCode" name="productCode">
      <option *ngFor="let p of productCodeOptions" [value]="p.value">
        {{ p.label }}
      </option>
    </select>
  </div>

  <div class="flex justify-end mt-3">
    <button pButton type="button" label="Annuler" class="p-button-text" 
            (click)="displayProductCodeDialog=false"></button>
    <button pButton type="button" label="Valider" class="p-button-success ml-2"
            [disabled]="!selectedProductCode"
            (click)="goToCreateContratWithProductCode()"></button>
  </div>
</p-dialog>
