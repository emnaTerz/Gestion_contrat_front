

    <div class="contrat-main-container" [class.split-view]="showModele"> 
  <div class="contrat-container">
    <p-toast></p-toast>
    <p-steps [model]="steps" [(activeIndex)]="currentStep"></p-steps>
    
    <div style="display: flex; justify-content: flex-end; margin: 1rem 0;">
      <button 
        pButton 
        label="{{ showModele ? 'Fermer le mod√®le' : 'Voir le mod√®le' }}" 
        icon="{{ showModele ? 'pi pi-eye-slash' : 'pi pi-eye' }}"
        (click)="toggleModele()" 
        class="p-button-info"
      >
      </button>
    </div>
  <div class="form-content">
    <!-- √âtape 0 : Informations g√©n√©rales -->
    <div *ngIf="currentStep === 0">
      <div class="contrat-upload-container contrat-section">
        <div class="card">
          <div class="card-title">Importer votre Contrat</div>
          <input 
            type="file" 
            (change)="onPdfSelected($event)" 
            accept=".pdf,.doc,.docx"
            style="padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px;"
          />
          <small>Choisissez un fichier PDF pour remplir automatiquement les informations g√©n√©rales.</small>
        </div>
      </div>
          

      <!-- Section Adh√©rent -->
      <div class="contrat-section">
        <h3>Informations g√©n√©rales</h3>
        <!-- Nature du contrat -->
          <div class="contrat-section">
            <label for="nature">Nature du contrat :</label>
            <select id="nature" [(ngModel)]="nature">
              <option value="contrat">Contrat</option>
              <option value="Offre">Offre</option>
              <option value="Projet de contrat">Projet de contrat</option>
            </select>
          </div>
        <h4>Adh√©rent</h4>
        <label>Code Adh√©rent:</label>
        <input type="text" [(ngModel)]="adherent.codeId">
        <label>Nom / Raison sociale:</label>
        <input type="text" [(ngModel)]="adherent.nomRaison">
        <label>Adresse:</label>
        <input type="text" [(ngModel)]="adherent.adresse">
        <label>Profession:</label>
        <input type="text" [(ngModel)]="adherent.activite">
        <label>
          <input type="checkbox" [(ngModel)]="adherent.nouveau">
          Nouvel adh√©rent ?
        </label>
      </div>

      <!-- Branche -->
      <div class="contrat-section">
        <label for="branche">Branche:</label>
        <select id="branche" [(ngModel)]="branche" (ngModelChange)="onBrancheChange()">
          <option *ngFor="let opt of brancheOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>
        <label for="codeProduit">Code Produit:</label>
  <input id="codeProduit" type="text" [(ngModel)]="service" />
      </div>

      <!-- Num√©ro police / assureur / agence -->
      <div class="contrat-section">
        <label>Num√©ro de police:</label>
        <input type="text" [(ngModel)]="numPolice">
        <label>Activit√© professionnelle de l'Assur√©:</label>
        <input type="text" [(ngModel)]="nom_assure">
        <label>Code Agence:</label>
        <input type="text" [(ngModel)]="codeAgence">
      </div>

      <!-- Fractionnement / Code renouvellement / Type contrat -->
      <div class="contrat-section">
        <label for="fractionnement">Fractionnement:</label>
        <select id="fractionnement" [(ngModel)]="fractionnement">
          <option *ngFor="let opt of fractionnementOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>

        <label for="codeRenouvellement">Code Renouvellement:</label>
        <select id="codeRenouvellement" [(ngModel)]="codeRenouvellement">
          <option *ngFor="let opt of codeRenouvellementOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>

        <label for="typeContrat">Type de contrat:</label>
        <select id="typeContrat" 
                [ngModel]="typeContrat"
                (change)="onTypeContratChange($any($event.target).value)"
                class="form-control">
          <option *ngFor="let opt of typeContratOptions" [value]="opt.value">
            {{ opt.label }}
          </option>
        </select>
      </div>

      <!-- Dates -->
      <div class="contrat-section">
        <label>Date de d√©but:</label>
        <input type="date" [(ngModel)]="dateDebut">
        <label>Date de fin:</label>
        <input type="date" [(ngModel)]="dateFin">
        <label>Date de l'offre:</label>
        <input type="date" [(ngModel)]="dateOffre">
      </div>

      <!-- Bouton Suivant -->
      <div style="margin-top: 10px; display: flex; gap: 1rem;">
        <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
      </div>
    </div>

    <!-- === Step Pr√©ambule === -->
    <div *ngIf="currentStep === 1" class="contrat-section preambule-section">
      <h3>Pr√©ambule du contrat</h3>
      <textarea id="preambuleTextarea"
                class="p-inputtextarea p-component"
                rows="10"
                [(ngModel)]="preambule"
                [attr.maxlength]="preambuleMaxLength"
                style="width:100%; resize:vertical;"></textarea>

      <div class="p-t-2" style="display:flex; justify-content:space-between; align-items:center; margin-top:0.5rem;">
        <div style="margin-top: 10px; display: flex; gap: 1rem;">
          <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
          <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
        </div>
      </div>
    </div>
<!-- √âtape 1bis : Extensions (uniquement pour typeContrat = 'APPEL_D_OFFRE') -->
<div *ngIf="currentStep === 2 && typeContrat === 'APPEL_D_OFFRE'" class="contrat-section">

  <h3 class="section-title">üìÑ Extensions du contrat</h3>

  <div 
    *ngFor="let ext of extensions; let i = index"
    class="extension-card"
  >
    <div class="extension-header">
      <span class="extension-number">Extension {{ i + 1 }}</span>

      <button pButton 
              icon="pi pi-trash" 
              class="p-button-rounded p-button-danger p-button-sm"
              (click)="removeExtension(i)">
      </button>
    </div>

    <div class="extension-body">

      <label class="input-label">Titre :</label>
      <input 
        type="text" 
        [(ngModel)]="ext.titre"
        placeholder="Saisir le titre de l'extension"
        class="input-text"
      >

      <label class="input-label">Texte :</label>
      <textarea 
        [(ngModel)]="ext.texte"
        rows="3"
        placeholder="Saisir le texte de l'extension"
        class="input-textarea"
      ></textarea>

    </div>
</div>
 <button pButton 
          icon="pi pi-plus" 
          label="Ajouter une extension"
          class="p-button-primary"
          (click)="addExtension()">
  </button>
  <div style="margin-top: 10px; display: flex; gap: 1rem;">
    <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
    <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
  </div>
</div>

    <!-- √âtape 2 : Situations -->
    <div *ngIf="currentStep === 3">
      <div class="contrat-section">
        <h3>Situations de risque</h3>

        <label>Identification:</label>
        <input type="text" [(ngModel)]="currentSituationRisque.identification">
        <label>Adresse:</label>
        <input type="text" [(ngModel)]="currentSituationRisque.adresse">
        <label>Nature de construction:</label>
        <input type="text" [(ngModel)]="currentSituationRisque.natureConstruction">
        <label>Contigu√Øt√©:</label>
        <input type="text" [(ngModel)]="currentSituationRisque.contiguite">
        <label>Avoisinage:</label>
        <input type="text" [(ngModel)]="currentSituationRisque.avoisinage">

        <div style="margin-top: 10px; display: flex; gap: 1rem;">
          <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
          <button pButton [label]="editIndex !== null ? 'Valider la modification' : 'Ajouter cette situation'" (click)="addSituation()"></button>
          <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
        </div>
      </div>

      <div *ngIf="situationRisques.length > 0" style="margin-top: 2rem;">
        <h4>Situations ajout√©es :</h4>
        <ul>
          <li *ngFor="let s of situationRisques; let i = index">
            <span 
              style="cursor: pointer; text-decoration: underline; color: #02bd4a;" 
              (click)="editSituation(i)">
              {{ i + 1 }}. {{ s.identification }} - {{ s.adresse }}
            </span>
            <i class="pi pi-trash" 
               style=" color: #388e3c; cursor: pointer; font-size: 1rem; margin-left: 10px;" 
               (click)="removeSituation(i)" 
               title="Supprimer"></i>
          </li>
        </ul>
      </div>
    </div>

    <!-- √âtape 3 : Garanties -->
    <div *ngIf="currentStep === 4">
      <div class="contrat-section">
        <h3>Garanties par situation de risque</h3>

        <div *ngFor="let s of situationRisques; let i = index" class="contrat-section">
          <h4>Situation {{ i + 1 }} : {{ s.identification }}</h4>
          <p>Adresse: {{ s.adresse }}</p>

          <div *ngFor="let g of s.garanties; let j = index" class="garantie-item">
            <input type="hidden" [(ngModel)]="g.sectionId">

            <label for="sousGarantie">Garanties:</label>
            <select id="sousGarantie" [(ngModel)]="g.sousGarantieId" (change)="onGarantieChange(g)">
              <option [value]="0">S√©lectionner une garantie</option>
              <option *ngFor="let opt of sousGarantiesOptions" [value]="opt.value">{{ opt.label }}</option>
            </select>

            <label>Capitale Assur√©:</label>
            <input type="number" [(ngModel)]="g.capitale">

            <!-- Checkbox Franchise -->
            <div style="margin-bottom: 1rem;">
              <label>
                <input type="checkbox" [(ngModel)]="g.hasFranchise"> Franchise
              </label>
            </div>

            <!-- Champs Franchise affich√©s seulement si checkbox coch√© -->
            <div class="franchise-fields" *ngIf="g.hasFranchise">
              <label>Franchise (%):</label>
              <input type="number" [(ngModel)]="g.franchise" placeholder="Pourcentage">
              <label>Minimum:</label>
              <input type="number" [(ngModel)]="g.minimum" placeholder="Montant minimum">
              <label>Maximum:</label>
              <input type="number" [(ngModel)]="g.maximum" placeholder="Montant maximum">
            </div>

            <label>Prime NET:</label>
            <input type="number" [(ngModel)]="g.primeNET">

            <i class="pi pi-trash" 
               style="color: #388e3c; cursor: pointer; font-size: 1rem; margin-left: 5px;" 
               (click)="removeGarantie(s, j)" 
               title="Supprimer"></i>

            <hr>
          </div>

          <button pButton type="button" label="Ajouter Garantie" (click)="addGarantie(s)"></button>
        </div>
      </div>

      <div style="margin-top: 10px; display: flex; gap: 1rem;">
        <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
        <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
      </div>
    </div>

    <!-- √âtape 4 : Exclusions -->
   <div *ngIf="currentStep === 5" class="contrat-section">
      <h3>Exclusions par garantie</h3>
      
      <div *ngFor="let s of situationRisques; let i = index">
        <h4>Situation {{ i + 1 }} : {{ s.identification }}</h4>

        <div *ngIf="getSousGarantiesParParent(s).length > 0; else noGaranties">
          
          <div *ngFor="let groupe of getSousGarantiesParParent(s); let groupeIndex = index" 
               class="groupe-garantie">
            
            <h5>Garantie : {{ groupe.parent.libelle || 'Garantie sans nom' }}</h5>

            <div class="ajout-exclusion" 
                 *ngIf="groupe.sousGaranties && groupe.sousGaranties.length > 0 && groupe.sousGaranties[0]"
                 style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
              
              <label style="font-weight: bold; display: block; margin-bottom: 0.5rem;">
                Ajouter une nouvelle exclusion pour cette garantie :
              </label>
              
              <div style="display: flex; gap: 0.5rem;">
                <input 
                  type="text" 
                  [(ngModel)]="groupe.sousGaranties[0].nouvelleExclusion"
                  placeholder="Saisir le nom de la nouvelle exclusion..."
                  style="flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;"
                  (keyup.enter)="ajouterExclusionPersonnalisee(groupe.sousGaranties[0])">
                
                <button 
                  pButton 
                  label="Ajouter" 
                  icon="pi pi-plus"
                  (click)="ajouterExclusionPersonnalisee(groupe.sousGaranties[0])"
                  class="p-button-sm bouton-ajout-exclusion"
                  style="height: 38px; min-width: 100px; display: flex; align-items: center; justify-content: center;"
                  [disabled]="!groupe.sousGaranties[0].nouvelleExclusion?.trim()">
                </button>
              </div>
            </div>

            <div *ngIf="groupe.sousGaranties && groupe.sousGaranties.length > 0 && groupe.sousGaranties[0] && 
                        groupe.sousGaranties[0].exclusionsOptions && groupe.sousGaranties[0].exclusionsOptions.length > 0" 
                 class="exclusions-container">
              
              <label class="exclusions-label">S√©lectionner les exclusions applicables :</label>
              
              <div class="exclusions-scroll-container" tabindex="0" 
                   (keydown)="handleKeyboardExclusions($event, groupe.sousGaranties[0])">
                
                <div class="exclusions-list">
                  <div *ngFor="let exclusion of groupe.sousGaranties[0].filteredExclusionsOptions; let exclIndex = index" 
                       class="exclusion-item">
                    
                    <input 
                      type="checkbox" 
                      [id]="'exclusion_' + i + '_' + groupeIndex + '_' + exclIndex"
                      [checked]="isExclusionSelected(groupe.sousGaranties[0], exclusion.id)"
                      (change)="toggleExclusion(groupe.sousGaranties[0], exclusion.id)"
                      class="exclusion-checkbox">
                    
                    <label 
                      [for]="'exclusion_' + i + '_' + groupeIndex + '_' + exclIndex" 
                      class="exclusion-text">
                      {{ exclusion.nom }}
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="!(groupe.sousGaranties && groupe.sousGaranties[0] && groupe.sousGaranties[0].exclusionsOptions) || 
                        (groupe.sousGaranties && groupe.sousGaranties[0] && groupe.sousGaranties[0].exclusionsOptions && 
                         groupe.sousGaranties[0].exclusionsOptions.length === 0)">
              <p>‚ö†Ô∏è Aucune exclusion disponible pour cette garantie.</p>
            </div>

          </div>
        </div> 

        <ng-template #noGaranties>
          <p>Aucune garantie disponible pour cette situation.</p>
        </ng-template>
      </div>

      <div style="margin-top: 10px; display: flex; gap: 1rem;">
        <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
        <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
      </div>
    </div>    

    <!-- √âtape 5 : RC Exploitation -->
    <div *ngIf="currentStep === 6" class="contrat-section">
      <h3>RC Exploitation</h3>

      <!-- Objet de la garantie -->
      <div class="card" style="background-color: #e8f5e9; margin-bottom: 2rem;">
        <label>Objet de la garantie</label>
        <textarea 
          [value]="objetGarantieRc" 
          rows="3" 
          class="p-inputtextarea p-component"
          style="width: 100%; resize: vertical;"
          readonly
        ></textarea>
      </div>

      <!-- Liste des RC Exploitation existantes -->
      <div *ngIf="rcExploitations.length > 0" style="margin-top: 2rem;">
        <h4>RC Exploitation configur√©es :</h4>
        <div *ngFor="let rc of rcExploitations; let i = index" class="rc-item card" style="padding: 1rem; margin-bottom: 1rem; border-left: 4px solid #388e3c;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
              <strong>RC {{ i + 1 }}</strong>
              <div style="margin-top: 0.5rem;">
                <strong>Param√®tres :</strong><br>
                ‚Ä¢ Dommages Corporels: {{ rc.limiteAnnuelleDomCorporels }}<br>
                ‚Ä¢ Dommages Mat√©riels: {{ rc.limiteAnnuelleDomMateriels }}<br>
                ‚Ä¢ limite Par Sinistre Corporels: {{ rc.limiteParSinistreCorporels }}<br>
                ‚Ä¢ limite Par Sinistre Materiels: {{ rc.limiteParSinistreMateriels }}<br>
                ‚Ä¢ Franchise: {{ rc.franchise }}<br>
                ‚Ä¢ Maximum: {{ rc.maximum }}<br>
                ‚Ä¢ Minimum: {{ rc.minimum }}<br>
                ‚Ä¢ Prime NET: {{ rc.primeNET }}
              </div>
              <div style="margin-top: 0.5rem;">
                <strong>Situations couvertes :</strong><br>
                {{ getRcSituationsNames(rc) }}
              </div>
              <div style="margin-top: 0.5rem;">
                <strong>Exclusions ({{ (rc.exclusionsIds || []).length }})</strong>
              </div>
            </div>
            <div>
              <i class="pi pi-pencil" 
                 style="color: #388e3c; cursor: pointer; margin-right: 10px;" 
                 (click)="editRcExploitation(i)"
                 title="Modifier"></i>
              <i class="pi pi-trash" 
                 style="color: #e74c3c; cursor: pointer;" 
                 (click)="removeRcExploitation(i)"
                 title="Supprimer"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="contrat-section">
        <h4>{{ rcExploitations.length > 0 ? 'Ajouter une autre RC Exploitation' : 'Configurer une RC Exploitation' }}</h4>
        <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
          <div class="form-group">
            <label>Limite annuelle Dommages Corporels</label>
            <input type="number" [(ngModel)]="currentRcExploitation.limiteAnnuelleDomCorporels">
          </div>
<div class="form-group">
            <label>Limite par sinistre Corporels</label>
            <input type="number" [(ngModel)]="currentRcExploitation.limiteParSinistreCorporels">
          </div>
          <div class="form-group">
            <label>Limite annuelle Dommages Mat√©riels</label>
            <input type="number" [(ngModel)]="currentRcExploitation.limiteAnnuelleDomMateriels">
          </div>

          
          <div class="form-group">
            <label>Limite par sinistre Materiels</label>
            <input type="number" [(ngModel)]="currentRcExploitation.limiteParSinistreMateriels">
          </div>

          <div class="form-group">
            <label>Franchise</label>
            <input type="number" [(ngModel)]="currentRcExploitation.franchise">
          </div>
          <div class="form-group">
            <label>Maximum</label>
            <input type="number" [(ngModel)]="currentRcExploitation.maximum">
          </div>
  <div class="form-group">
            <label>Minimum</label>
            <input type="number" [(ngModel)]="currentRcExploitation.minimum">
          </div>

          <div class="form-group">
            <label>Prime Net</label>
            <input type="number" [(ngModel)]="currentRcExploitation.primeNET">
          </div>
        </div>
        <h5>S√©lectionner les situations pour cette RC :</h5>
        <div class="situations-list">
          <div *ngFor="let s of situationRisques" class="situation-item" style="padding: 0.5rem; border-bottom: 1px solid #eee;">
            <label [class.disabled]="isSituationUsedInOtherRc(s, currentRcExploitation.id)" 
                   style="display: flex; align-items: center; gap: 0.5rem;">
              <input 
                type="checkbox" 
                [checked]="isRcSituationSelected(s)" 
                (change)="toggleRcSituation(s, $event)"
                [disabled]="isSituationUsedInOtherRc(s, currentRcExploitation.id)"
                style="margin: 0;">
              <div>
                <strong>{{ s.identification }}</strong>
                <div style="font-size: 0.8em; color: #666;">{{ s.adresse }}</div>
                <div *ngIf="isSituationCoveredByRc(s)" style="font-size: 0.8em; color: #388e3c;">
                  ‚úì D√©j√† couverte par une RC
                </div>
              </div>
              <span *ngIf="isSituationUsedInOtherRc(s, currentRcExploitation.id)" 
                    style="color: #999; font-size: 0.8em; margin-left: auto;">
                (d√©j√† utilis√©e dans une autre RC)
              </span>
            </label>
          </div>
        </div>

    

        <!-- Exclusions -->
        <div class="exclusions-section" style="margin-top: 2rem;">
          <h5>Exclusions pour cette RC :</h5>

          <div class="ajout-exclusion" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px;">
            <label style="font-weight: bold; display: block; margin-bottom: 0.5rem;">
              Ajouter une nouvelle exclusion RC :
            </label>
            <div style="display: flex; gap: 0.5rem;">
              <input 
                type="text" 
                [(ngModel)]="nouvelleExclusionRC"
                placeholder="Saisir le nom de la nouvelle exclusion RC..."
                style="flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;"
                (keyup.enter)="ajouterExclusionRC()">
              <button 
                pButton 
                label="Ajouter" 
                icon="pi pi-plus"
                (click)="ajouterExclusionRC()"
                class="p-button-sm"
                style="height: 38px; min-width: 100px;">
              </button>
            </div>
          </div>

          <div *ngIf="filteredExclusionsRC.length > 0" class="exclusions-container">
            <label class="exclusions-label">S√©lectionner les exclusions applicables :</label>
            
            <div class="exclusions-scroll-container" tabindex="0"> 
              <div class="exclusions-list">
                <div *ngFor="let ex of filteredExclusionsRC; let exclIndex = index" 
                     class="exclusion-item" style="padding: 0.5rem; border-bottom: 1px solid #eee;">
                  
                  <input 
                    type="checkbox" 
                    [id]="'exclusionRC_' + ex.id"
                    [checked]="currentRcExploitation.exclusionsIds.includes(ex.id)"
                    (change)="toggleCurrentRcExclusion(ex.id, $event)"
                    class="exclusion-checkbox"
                    style="margin-right: 0.5rem;">
                  
                  <label 
                    [for]="'exclusionRC_' + ex.id" 
                    class="exclusion-text"
                    style="cursor: pointer;">
                    {{ ex.nom }}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bouton Ajouter -->
        <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
          <button 
            pButton 
            type="button" 
            [label]="currentRcExploitation.situations.length > 0 ? 'Ajouter cette RC' : 'Ajouter RC'" 
            (click)="addRcExploitation()"
            [disabled]="currentRcExploitation.situations.length === 0 || !canAddNewRc"
            class="p-button-success"
            style="margin-top: 1rem;">
          </button>
          
          <span *ngIf="!canAddNewRc" style="color: #666; font-size: 0.9em;">
            ‚ùå Toutes les situations sont d√©j√† couvertes par une RC
          </span>
          
          <span *ngIf="currentRcExploitation.situations.length === 0 && canAddNewRc" style="color: #666; font-size: 0.9em;">
            ‚ö†Ô∏è Veuillez s√©lectionner au moins une situation
          </span>
        </div>
      </div>

      <!-- Navigation -->
      <div style="margin-top: 2rem; display: flex; gap: 1rem;">
         <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
        <button pButton label="Suivant ‚Üí" (click)="nextStep()"></button>
      </div>
    </div>
    </div>
   <!-- √âtape 7 : S√©lection des Clausiers -->
<div *ngIf="currentStep === 7" class="contrat-section">
  <h3>S√©lection des Clausiers</h3>
  
  <div class="clausier-selection">
    <p class="section-subtitle">Choisissez les clausiers √† int√©grer dans votre contrat</p>
    
    <div *ngIf="clausiers.length > 0; else noClausiers" class="clausiers-grid">
      <div *ngFor="let clausier of clausiers" 
           class="clausier-card" 
           [class.selected]="isClausierSelected(clausier.id)"
           (click)="toggleClausierSelection(clausier)">
        
        <div class="clausier-checkbox">
          <input 
            type="checkbox" 
            [checked]="isClausierSelected(clausier.id)"
            (change)="toggleClausierSelection(clausier)"
            (click)="$event.stopPropagation()">
        </div>
        
        <div class="clausier-content">
          <i class="pi pi-file" [class.has-file]="clausier.file"></i>
          <span class="clausier-name">{{ clausier.nom }}</span>
        </div>
        
        <div *ngIf="isClausierSelected(clausier.id)" class="selection-indicator">
          <i class="pi pi-check"></i>
        </div>
      </div>
    </div>

    <ng-template #noClausiers>
      <div class="empty-state">
        <i class="pi pi-inbox"></i>
        <p>Aucun clausier disponible</p>
      </div>
    </ng-template>
  </div>

  <!-- Navigation -->
  <div class="navigation-buttons">
    <button pButton label="‚Üê Pr√©c√©dent" (click)="prevStep()"></button>
    <button pButton label="Soumettre" (click)="submit()" class="p-button-success"></button>
  </div>
</div>
  </div> <!-- Fin de contrat-container -->
<div class="pdf-sidebar" *ngIf="showModele">
    <div class="pdf-container">
      <div class="pdf-header">
        <h3>Mod√®le de Contrat</h3>
        <button 
          pButton 
          icon="pi pi-times" 
          class="p-button-text p-button-sm"
          (click)="toggleModele()"
          title="Fermer">
        </button>
      </div>
      
      <ng-container *ngIf="pdfUrl; else loading">
        <iframe [src]="pdfUrl" width="100%" height="100%"></iframe>
      </ng-container>
      
      <ng-template #loading>
        <div class="loading-content">
          <p *ngIf="contratData || situationRisques.length > 0" class="loading-text">
            <i class="pi pi-spin pi-spinner" style="margin-right: 8px;"></i>
            G√©n√©ration du PDF en cours...
          </p>
          <p *ngIf="!contratData && situationRisques.length === 0" class="no-data-text">
            <i class="pi pi-info-circle" style="margin-right: 8px;"></i>
            Veuillez d'abord cr√©er au moins une situation de risque pour g√©n√©rer le PDF.
          </p>
        </div>
      </ng-template>
    </div>
    
  </div>
</div> <!-- Fin de contrat-main-container -->